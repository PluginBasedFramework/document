# 实例
以一个简单的IM软件为例，演示此框架的使用方式。

## 各插件的开发
### 初始状态
领域对象：

![root](http://yuml.me/diagram/nofunky/class/[System].svg)
### account 插件（在System使用）
领域对象：

![Account](http://yuml.me/diagram/nofunky/class/[System]*-know*[Account].svg)

配置：

1. add P: Account container
2. add M: createAccount
3. add M: registerAccount //注册一个现有的Account
4. add M: onNewAccount
5. add M: authenticateAccount
6. add M: removeAccount
7. add M: onRemoveAccount

### session 插件（在System使用）
领域对象：

![session](http://yuml.me/diagram/nofunky/class/[System]*-know*[Account], [System]1-*[Session], [Session]1-1[Account].svg)

配置：

dependsOn account plugin

1. add P: Session container
2. add M: createSession
3. add M: loginAccount
 1. authenticateAccount
 2. createSession
4. add M: onNewSession
5. add M: removeSession
6. add M: logoutAccount
  1. removeSession
7. add M: onRemoveAccount

### receive 插件（在Session、Dialog使用）
领域对象：

![session](http://yuml.me/diagram/nofunky/class/[System]*-know*[Account], [System]1-*[Session], [Session]1-1[Account].svg)

配置：

1. add M: onReceiveMessage
2. add M: receiveMessage

### send 插件（在Session、Dialog使用）
领域对象：

![session](http://yuml.me/diagram/nofunky/class/[System]*-know*[Account], [System]1-*[Session], [Session]1-1[Account].svg)

配置：

1. add M: onSendMessage
2. add M: sendMessage

### dialog 插件（在Session使用）
领域对象：

![dialog](http://yuml.me/diagram/nofunky/class/[System]*-know*[Account], [System]1-*[Session], [Session]1-1[Account], [Session]1-*[Dialog].svg)

配置：

1. add P: Dialog container
2. add M: onNewDialog
3. add M: createDialog

### session-receive-to-dialog 插件（在Session使用）
领域对象：

![dialog](http://yuml.me/diagram/nofunky/class/[System]*-know*[Account], [System]1-*[Session], [Session]1-1[Account], [Session]1-*[Dialog].svg)

配置：

dependsOn dialog plugin,dependsOn receive plugin in session, dependsOn receive plugin in dialog, 

```
onReceiveMessage {message ->
    def dialog = dialogs.getByTarget(message.from)
    if (dialog == null) {
        dialog = createDialog(message.from)
    }
    dialog.receiveMessage（message)
}
```

## 应用的配置

TBD
